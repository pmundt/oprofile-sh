# $Id$

INSTALL_LIST=oprofiled op_start op_dump op_stop

CFLAGS=-Wall -Wstrict-prototypes -pipe -Wunused -W -Wshadow -Wmissing-prototypes -Winline @CFLAGS@
LIBS=@extra_libraries@ -lpopt -liberty

SOURCES=oprofiled.c opd_util.c opd_proc.c opd_kernel.c
OBJS=oprofiled.o opd_util.o opd_proc.o opd_kernel.o ../events/op_events.o ../events/op_events_desc.o ../util/op_popt.o ../util/misc.o

.PHONY: all clean srcdoc install uninstall

all: oprofiled

install: all
	-$(MKDIR_P) $(BINDIR)
	for f in $(INSTALL_LIST); do \
		cp $$f $(BINDIR)/$$f && chmod 755 $(BINDIR)/$$f; \
	done

uninstall:
	for f in $(INSTALL_LIST); do \
		rm -f $(BINDIR)/$$f; \
	done

clean:
	rm -rf oprofiled *.o .deps oprofiled-src.html 

srcdoc: oprofiled-src.html

oprofiled-src.html: $(SOURCES)
	../scripts/dodoc -html $(SOURCES) >oprofiled-src.html

oprofiled: $(OBJS) ../libdb/libdb.a
	$(CC) $(CFLAGS) $(INCLUDES) -g -o $@ $^ $(LIBS)

%.o: %c
	$(CC) -c $(CFLAGS) -g $< -o $@

ALL_SOURCES = $(SOURCES)

include ../Rules.make
