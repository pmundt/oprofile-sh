RM=rm
CP=cp
prefix=$(DESTDIR)@prefix@
MANDIR=@mandir@/man1
CATDIR=@mandir@/cat1
DOCDIR=$(prefix)/share/doc/oprofile
LN_SF=ln -sf
MKDIR=mkdir
MKDIR_P=mkdir -p
XSLTPROC=xsltproc
LINK_LIST=oprofiled.1 op_start.1 op_stop.1 op_help.1 oprofpp.1 op_time.1 op_to_source.1 op_merge.1
XHTML_STYLESHEET=xsl/xhtml.xsl
CHUNK_XHTML_STYLESHEET=xsl/xhtml-chunk.xsl
STYLESHEETS=$(XHTML_STYLESHEET) $(CHUNK_XHTML_STYLESHEET) xsl/xhtml-common.xsl
 
.PHONY: all clean install uninstall

all: oprofile.html

# sedall '' ''
oprofile.html: oprofile.xml $(STYLESHEETS)
	$(XSLTPROC) $(XHTML_STYLESHEET) $< > $@

# sedall '' ''
chunk: oprofile.xml $(STYLESHEETS)
	$(XSLTPROC) $(CHUNK_XHTML_STYLESHEET) $<

install: all
	-$(MKDIR_P) $(MANDIR)
	cp oprofile.1 $(MANDIR)/oprofile.1
	@for f in $(LINK_LIST); do				\
		$(RM) -f $(MANDIR)/$$f;				\
		echo ".so man1/oprofile.1" > $(MANDIR)/$$f;	\
	done
	@echo "Installing html doc in $(DOCDIR)"
	@$(MKDIR_P) $(DOCDIR)
	@cp -R *.html $(DOCDIR)

uninstall:
	rm -f $(MANDIR)/oprofile.1
	rm -f @mandir@/cat1/oprofile.1.gz
	@for f in $(LINK_LIST); do		\
		rm -f $(MANDIR)/$$f;		\
		rm -f $(CATDIR)/cat1/$$f.gz;	\
	done
	-$(RM) -rf $(DOCDIR)

clean:
	-$(RM) -rf *.html
