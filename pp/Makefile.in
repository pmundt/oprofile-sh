INSTALL_LIST=oprofpp op_to_source op_time op_merge

CFLAGS=@CFLAGS@ -pedantic -Wall -W -Wstrict-prototypes -Wunused -Wshadow -Wmissing-prototypes -Winline
CXXFLAGS=@CXXFLAGS@ @BFD_CXXFLAGS@ -ansi -Wall -W -Wunused -Wmissing-prototypes
LIBS=-lpopt -lbfd -liberty -ldl
MY_SOURCES=oprofpp.cpp oprofpp_util.cpp
OBJS=../events/op_events.o ../events/op_events_desc.o ../dae/opd_util.o oprofpp_util.o ../util/op_popt.o ../util/file_manip.o  ../util/string_manip.o ../util/misc.o ../libdb/libdb.a

all: $(INSTALL_LIST)

.PHONY: all clean srcdoc install uninstall

clean: 
	rm -rf *.o .deps oprofpp-src.html $(INSTALL_LIST)

install: all
	-$(MKDIR_P) $(BINDIR)
	for f in $(INSTALL_LIST); do \
		cp $$f $(BINDIR)/$$f && chmod 755 $(BINDIR)/$$f; \
	done

uninstall:
	for f in $(INSTALL_LIST); do \
		rm -f $(BINDIR)/$$f; \
	done

srcdoc: oprofpp-src.html

oprofpp-src.html: $(MY_SOURCES)
	../scripts/dodoc -html $(MY_SOURCES) >oprofpp-src.html

oprofpp: oprofpp.o $(OBJS) opf_container.o opp_symbol.o demangle_symbol.o
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LIBS)

op_to_source: opf_filter.o opf_container.o demangle_symbol.o ../util/child_reader.o $(OBJS) \
 ../util/string_manip.o
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LIBS)

op_time: op_time.o $(OBJS) opf_container.o demangle_symbol.o opp_symbol.o
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LIBS)

op_merge: op_merge.o $(OBJS)
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LIBS)

%.o: %c
	$(CC) -c $(CFLAGS) $(INCLUDES) -g $< -o $@

%.o: %cpp
	$(CXX) -c $(CXXFLAGS) $(INCLUDES) -g $< -o $@

ALL_SOURCES = oprofpp.cpp oprofpp_util.cpp demangle_symbol.cpp opf_container.cpp opf_filter.cpp op_time.cpp op_merge.cpp opp_symbol.cpp

include ../Rules.make
