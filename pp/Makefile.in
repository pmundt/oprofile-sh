include ../make.common

OPROFPP_SOURCES=samples_container.cpp sample_container_imp.cpp symbol_container_imp.cpp \
	oprofpp.cpp oprofpp_util.cpp opp_symbol.cpp demangle_symbol.cpp op_bfd.cpp samples_file.cpp
OP_TO_SOURCE_SOURCES=op_to_source.cpp op_bfd.cpp samples_file.cpp
OP_TIME_SOURCES=op_time.cpp op_bfd.cpp samples_file.cpp
OP_MERGE_SOURCES=op_merge.cpp op_bfd.cpp samples_file.cpp
SOURCES=$(OPROFPP_SOURCES) $(OP_TO_SOURCE_SOURCES) $(OP_TIME_SOURCES) $(OP_MERGE_SOURCES)

COMMON_OBJECTS=samples_container.o sample_container_imp.o symbol_container_imp.o \
	oprofpp_util.o demangle_symbol.o op_bfd.o samples_file.o
OPROFPP_OBJECTS=oprofpp.o opp_symbol.o $(COMMON_OBJECTS)
OP_TO_SOURCE_OBJECTS=op_to_source.o $(COMMON_OBJECTS)
OP_TIME_OBJECTS=op_time.o opp_symbol.o $(COMMON_OBJECTS)
OP_MERGE_OBJECTS=op_merge.o oprofpp_util.o op_bfd.o samples_file.o
OBJECTS=$(OPROFPP_OBJECTS) $(OP_TO_SOURCE_OBJECTS) $(OP_TIME_OBJECTS) $(OP_MERGE_OBJECTS)

OPROFPP_TARGET=oprofpp
OP_TO_SOURCE_TARGET=op_to_source
OP_TIME_TARGET=op_time
OP_MERGE_TARGET=op_merge
TARGET=$(OPROFPP_TARGET) $(OP_TO_SOURCE_TARGET) $(OP_TIME_TARGET) $(OP_MERGE_TARGET)

OPROFPP_LIBS=-lop -lutil++ -lutil -ldb -lpopt -lbfd -liberty -ldl
OP_TO_SOURCE_LIBS=-lop -lutil++ -lutil -ldb -lpopt -lbfd -liberty -ldl
OP_TIME_LIBS=-lop -lutil++ -lutil -ldb -lpopt -lbfd -liberty -ldl
OP_MERGE_LIBS=-lop -lutil++ -lutil -ldb -lpopt -lbfd -liberty -ldl

all: $(TARGET)

INSTALL_LIST=$(TARGET)
install:
	$(INSTALL) $(INSTALL_LIST) $(BINDIR)

uninstall:
	for f in $(INSTALL_LIST); do rm -f $(BINDIR)/$$f; done

clean:
	rm -rf .deps $(OBJECTS) $(TARGET) 

$(OPROFPP_TARGET): $(OPROFPP_OBJECTS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(OPROFPP_LIBS)

$(OP_TO_SOURCE_TARGET): $(OP_TO_SOURCE_OBJECTS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(OP_TO_SOURCE_LIBS)

$(OP_TIME_TARGET): $(OP_TIME_OBJECTS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(OP_TIME_LIBS)

$(OP_MERGE_TARGET): $(OP_MERGE_OBJECTS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(OP_MERGE_LIBS)

include ../make.deps
