# $Id$

.PHONY: all install clean distclean maintainerclean uninstall tags

# take care: order of sub-dir build is meaningfull.

all:
	$(MAKE) -C util
	$(MAKE) -C events
	$(MAKE) -C libdb
	$(MAKE) -C module
	$(MAKE) -C dae
	$(MAKE) -C pp
	$(MAKE) -C gui
	$(MAKE) -C oprof_report
	$(MAKE) -C doc

install: install.kernel install.user

install.kernel: all
	$(MAKE) -C module install DESTDIR=$(DESTDIR)

install.user: all
	$(MAKE) -C util install DESTDIR=$(DESTDIR)
	$(MAKE) -C events install DESTDIR=$(DESTDIR)
	$(MAKE) -C dae install DESTDIR=$(DESTDIR)
	$(MAKE) -C pp install DESTDIR=$(DESTDIR)
	$(MAKE) -C gui install DESTDIR=$(DESTDIR)
	$(MAKE) -C oprof_report install DESTDIR=$(DESTDIR)
	$(MAKE) -C doc install DESTDIR=$(DESTDIR)

uninstall:
	$(MAKE) -C events uninstall
	$(MAKE) -C module uninstall
	$(MAKE) -C dae uninstall
	$(MAKE) -C pp uninstall
	$(MAKE) -C gui uninstall
	$(MAKE) -C oprof_report uninstall
	$(MAKE) -C doc uninstall
	@echo "Goodbye."

clean:
	rm -f *.o
	$(MAKE) -C util clean
	$(MAKE) -C events clean
	$(MAKE) -C libdb clean
	$(MAKE) -C module clean
	$(MAKE) -C dae clean
	$(MAKE) -C pp clean
	$(MAKE) -C doc clean
	$(MAKE) -C gui clean
	$(MAKE) -C oprof_report clean

# doc/Makefile is deleted here but should be deleted in distclean.
# When the dist target works move it as action of distclean.
maintainerclean: distclean
	rm -f configure doc/Makefile aclocal.m4 config.h.in

distclean: clean
	rm -f Makefile module/Makefile events/Makefile libdb/Makefile util/Makefile doc/oprofile.1 dae/Makefile pp/Makefile oprof_report/Makefile oprof_report/ui/Makefile gui/Makefile gui/ui/Makefile tags config.status config.log config.cache version.h Rules.make config.h

tags:
	ctags -R

# broken 
# dist check list:
# 1. change version to non-cvs and commit
# 2. make dist (with doopr) 
# 3. upload to sf
# 4. untar into webpage
# 5. add release
# 6. close fixed bugs
# 7. send release email
# 8. update freshmeat
# 9. cvs tag RELEASE_0_0_8
dist:
	mkdir tmpdist ; \
	cd tmpdist ; \
	cvs checkout oprofile ; \
	cd oprofile ; \
	(find -type d -name CVS | xargs rm -rf) ; \
	./autogen.sh ; \
	./configure ; \
	cp doc/Makefile doc/Makefile.tmp ; \
	make distclean ; \
	cd doc && make -f Makefile.tmp && rm -f Makefile.tmp && cd .. ; \
	cd .. ; \
	mv oprofile oprofile-@VERSION@ ; \
	tar cvfz ../oprofile-@VERSION@.tar.gz oprofile-@VERSION@ ; \
	rm -rf oprofile-@VERSION@ ; \
	cd ..  ; \
	rm -rf tmpdist \

