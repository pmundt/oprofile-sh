.PHONY: all install clean distclean maintainerclean uninstall tags

# take care: order of sub-dir build is meaningfull.

USER_SUBDIRS=libutil libutil++ libopt++ libop libdb dae utils pp gui oprof_report doc
SUBDIRS=$(USER_SUBDIRS) module

all:
	for i in $(SUBDIRS) ; \
	do \
		(cd $$i && $(MAKE)) || exit 1 ; \
	done

install: install.kernel install.user

install.kernel: all
	$(MAKE) -C module install DESTDIR=$(DESTDIR)

install.user: all
	for i in $(USER_SUBDIRS) ; \
	do \
		(cd $$i && $(MAKE) install) || exit 1 ; \
	done

uninstall:
	for i in $(SUBDIRS) ; \
	do \
		(cd $$i && $(MAKE) uninstall) || exit 1 ; \
	done
	@echo "Goodbye."

clean:
	for i in $(SUBDIRS) ; \
	do \
		(cd $$i && $(MAKE) clean) || exit 1 ; \
	done

maintainerclean: distclean
	rm -f configure aclocal.m4 config.h.in

distclean: clean
	rm -f Makefile tags config.status config.log config.cache make.common version.h config.h
	for i in $(SUBDIRS) ; \
	do \
		rm -f $$i/Makefile ; \
	done

tags:
	ctags -R

# broken 
# dist check list:
# 1. change version to non-cvs and commit
# 2. make dist (with doopr) 
# 3. upload to sf
# 4. add release
# 5. close fixed bugs
# 6. send release email
# 7. update freshmeat
# 8. cvs tag RELEASE_0_0_8
# 9. update webpage release-notes/, index, download, srcdoc/
dist:
	mkdir tmpdist ; \
	cd tmpdist ; \
	cvs checkout oprofile ; \
	cd oprofile ; \
	(find -type d -name CVS | xargs rm -rf) ; \
	./autogen.sh ; \
	./configure --mandir=/usr/local/share/man ; \
	cp doc/Makefile doc/Makefile.tmp ; \
	make distclean ; \
	cd doc && make -f Makefile.tmp && rm -f Makefile.tmp && cd .. ; \
	cd .. ; \
	mv oprofile oprofile-@VERSION@ ; \
	tar cvfz ../oprofile-@VERSION@.tar.gz oprofile-@VERSION@ ; \
	rm -rf oprofile-@VERSION@ ; \
	cd ..  ; \
	rm -rf tmpdist \

